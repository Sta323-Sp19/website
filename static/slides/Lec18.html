<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>dbplyr</title>
    <meta charset="utf-8" />
    <meta name="author" content="Colin Rundel" />
    <meta name="date" content="2019-04-04" />
    <link href="libs/font-awesome/css/all.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# dbplyr
### Colin Rundel
### 2019-04-04

---

exclude: true





---

## Database backends


```r
library(dplyr)

ls("package:dplyr") %&gt;% purrr::keep(stringr::str_detect, "^src")
```

```
## [1] "src"          "src_df"       "src_local"    "src_mysql"    "src_postgres"
## [6] "src_sqlite"   "src_tbls"
```

```r
?src_sqlite
```

---

## Wider Ecosystem

&lt;img src="imgs/implyr_logo.png" width="66%" style="display: block; margin: auto;" /&gt;&lt;img src="imgs/sparklyr_logo.png" width="66%" style="display: block; margin: auto;" /&gt;


---

## Creating a database 


```r
(db = dplyr::src_sqlite("/data/nyc_parking/nyc_parking_2014_cleaned.sqlite", create = TRUE))

##  src:  sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##  tbls:
```

--


```r
nyc_sql = dplyr::copy_to(db, nyc, temporary = FALSE)
db

## src:  sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
## tbls: nyc, sqlite_stat1, sqlite_stat4
```

--

```r
pryr::object_size(db)
## 6.54 kB

pryr::object_size(nyc_sql)
## 9.54 kB
```

```shell
&gt; ls -lah /data/nyc_parking/*.sqlite

-rw-r--r-- 1 cr173 visitor 698M Nov  5 13:57 /data/nyc_parking/nyc_parking_2014_cleaned.sqlite
```

---

.small[

```r
nyc_sql = dplyr::tbl(db, "nyc")

class(nyc_sql)
```

```
## [1] "tbl_SQLiteConnection" "tbl_dbi"              "tbl_sql"             
## [4] "tbl_lazy"             "tbl"
```
]

--

.small[

```r
nyc_sql
```

```
## # Source:   table&lt;nyc&gt; [?? x 18]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##    registration_st… plate_type issue_date violation_code vehicle_body_ty…
##    &lt;chr&gt;            &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;           
##  1 NJ               PAS             15706             20 SUBN            
##  2 MI               PAS             15706             99 SDN             
##  3 NY               PAS             15706             20 SUBN            
##  4 NY               PAS             15706             20 SDN             
##  5 NY               SRF             15706             20 SDN             
##  6 NY               PAS             15706             46 SUBN            
##  7 NY               PAS             15706             62 SDN             
##  8 NY               PAS             15706             98 SDN             
##  9 NY               PAS             15706             71 SDN             
## 10 NY               PAS             15706             71 SUBN            
## # … with more rows, and 13 more variables: vehicle_make &lt;chr&gt;,
## #   issuing_agency &lt;chr&gt;, violation_location &lt;chr&gt;, violation_precinct &lt;dbl&gt;,
## #   violation_time &lt;chr&gt;, house_number &lt;chr&gt;, street_name &lt;chr&gt;,
## #   intersecting_street &lt;chr&gt;, vehicle_color &lt;chr&gt;, issue_day &lt;int&gt;,
## #   issue_month &lt;dbl&gt;, issue_year &lt;dbl&gt;, issue_wday &lt;chr&gt;
```
]

--

.small[

```r
str(nyc_sql)
```

```
## List of 2
##  $ src:List of 2
##   ..$ con  :Formal class 'SQLiteConnection' [package "RSQLite"] with 7 slots
##   .. .. ..@ ptr                :&lt;externalptr&gt; 
##   .. .. ..@ dbname             : chr "/data/nyc_parking/nyc_parking_2014_cleaned.sqlite"
##   .. .. ..@ loadable.extensions: logi TRUE
##   .. .. ..@ flags              : int 70
##   .. .. ..@ vfs                : chr ""
##   .. .. ..@ ref                :&lt;environment: 0x55bbdb7b86d0&gt; 
##   .. .. ..@ bigint             : chr "integer64"
##   ..$ disco:&lt;environment: 0x55bbd8ddc180&gt; 
##   ..- attr(*, "class")= chr [1:4] "src_SQLiteConnection" "src_dbi" "src_sql" "src"
##  $ ops:List of 2
##   ..$ x   : 'ident' chr "nyc"
##   ..$ vars: chr [1:18] "registration_state" "plate_type" "issue_date" "violation_code" ...
##   ..- attr(*, "class")= chr [1:3] "op_base_remote" "op_base" "op"
##  - attr(*, "class")= chr [1:5] "tbl_SQLiteConnection" "tbl_dbi" "tbl_sql" "tbl_lazy" ...
```
]

---

## Using dplyr with sqlite 


```r
(addr = nyc_sql %&gt;%
   select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
   filter(precinct &gt;=1, precinct &lt;= 34)
)
```

```
## # Source:   lazy query [?? x 4]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##    issue_date precinct house_number street_name    
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;          
##  1      15706       28 102          W 123 ST       
##  2      15706       23 2121         1 AVE          
##  3      15706       23 60           E 106 ST       
##  4      15706        5 54           ELIZABETH ST   
##  5      15706       26 488-490      ST NICHOLAS AVE
##  6      15706       26 1420         AMSTERDAM AVE  
##  7      15706       25 219          E 121 ST       
##  8      15706       12 630          LEXINGTON AVE  
##  9      15706       18 413          48 TH ST       
## 10      15706       25 2123         MADISON AVE    
## # … with more rows
```



---

## SQL Query


```r
class(addr)
```

```
## [1] "tbl_SQLiteConnection" "tbl_dbi"              "tbl_sql"             
## [4] "tbl_lazy"             "tbl"
```

```r
show_query(addr)
```

```
## &lt;SQL&gt;
## SELECT *
## FROM (SELECT `issue_date`, `violation_precinct` AS `precinct`, `house_number`, `street_name`
## FROM `nyc`)
## WHERE ((`precinct` &gt;= 1.0) AND (`precinct` &lt;= 34.0))
```


---

## SQL Grouping 


```r
addr %&gt;% group_by(issue_date, precinct) %&gt;% summarize(n=n())
```

```
## # Source:   lazy query [?? x 3]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
## # Groups:   issue_date
##    issue_date precinct     n
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1      15706        5     1
##  2      15706       12     1
##  3      15706       13     1
##  4      15706       14     1
##  5      15706       18     1
##  6      15706       23     2
##  7      15706       25     3
##  8      15706       26     3
##  9      15706       28     1
## 10      15707        6     2
## # … with more rows
```

---

## SQL Query


```r
addr %&gt;% group_by(issue_date, precinct) %&gt;% summarize(n=n()) %&gt;% show_query()
```

```
## &lt;SQL&gt;
## SELECT `issue_date`, `precinct`, COUNT() AS `n`
## FROM (SELECT `issue_date`, `violation_precinct` AS `precinct`, `house_number`, `street_name`
## FROM `nyc`)
## WHERE ((`precinct` &gt;= 1.0) AND (`precinct` &lt;= 34.0))
## GROUP BY `issue_date`, `precinct`
```

---

## SQL Translation 

In general, dplyr / dbplyr knows how to translate basic math, logical, and summary functions from R to SQL. dbplyr has a function, `translate_sql`, that lets you experiment with how R functions are translated to SQL. 


```r
dbplyr::translate_sql(x == 1 &amp; (y &lt; 2 | z &gt; 3))
```

```
## &lt;SQL&gt; "x" = 1.0 AND ("y" &lt; 2.0 OR "z" &gt; 3.0)
```

```r
dbplyr::translate_sql(x ^ 2 &lt; 10)
```

```
## &lt;SQL&gt; POWER("x", 2.0) &lt; 10.0
```

```r
dbplyr::translate_sql(x %% 2 == 10)
```

```
## &lt;SQL&gt; "x" % 2.0 = 10.0
```


```r
dbplyr::translate_sql(mean(x))
```

```
## Warning: Missing values are always removed in SQL.
## Use `avg(x, na.rm = TRUE)` to silence this warning
```

```
## &lt;SQL&gt; avg("x") OVER ()
```

```r
dbplyr::translate_sql(mean(x, na.rm=TRUE))
```

```
## &lt;SQL&gt; avg("x") OVER ()
```


---

.small[

```r
dbplyr::translate_sql(sd(x))
```

```
## &lt;SQL&gt; SD("x")
```

```r
dbplyr::translate_sql(paste(x,y))
```

```
## &lt;SQL&gt; PASTE("x", "y")
```

```r
dbplyr::translate_sql(cumsum(x))
```

```
## Warning: Windowed expression 'sum("x")' does not have explicit order.
## Please use arrange() or window_order() to make determinstic.
```

```
## &lt;SQL&gt; sum("x") OVER (ROWS UNBOUNDED PRECEDING)
```

```r
dbplyr::translate_sql(lag(x))
```

```
## &lt;SQL&gt; LAG("x", 1, NULL) OVER ()
```

```r
dbplyr::translate_sql(lm(y~x))
```

```
## Error in UseMethod("escape"): no applicable method for 'escape' applied to an object of class "formula"
```
]


---

## Complications

.small[

```r
addr %&gt;% mutate(address = paste(house_number, street_name))
```

```
## # Source:   lazy query [?? x 5]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##    issue_date precinct house_number street_name     address                
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;                  
##  1      15706       28 102          W 123 ST        102 W 123 ST           
##  2      15706       23 2121         1 AVE           2121 1 AVE             
##  3      15706       23 60           E 106 ST        60 E 106 ST            
##  4      15706        5 54           ELIZABETH ST    54 ELIZABETH ST        
##  5      15706       26 488-490      ST NICHOLAS AVE 488-490 ST NICHOLAS AVE
##  6      15706       26 1420         AMSTERDAM AVE   1420 AMSTERDAM AVE     
##  7      15706       25 219          E 121 ST        219 E 121 ST           
##  8      15706       12 630          LEXINGTON AVE   630 LEXINGTON AVE      
##  9      15706       18 413          48 TH ST        413 48 TH ST           
## 10      15706       25 2123         MADISON AVE     2123 MADISON AVE       
## # … with more rows
```

```r
addr %&gt;% mutate(address = paste(house_number, street_name)) %&gt;% show_query()
```

```
## &lt;SQL&gt;
## SELECT `issue_date`, `precinct`, `house_number`, `street_name`, `house_number` || ' ' || `street_name` AS `address`
## FROM (SELECT `issue_date`, `violation_precinct` AS `precinct`, `house_number`, `street_name`
## FROM `nyc`)
## WHERE ((`precinct` &gt;= 1.0) AND (`precinct` &lt;= 34.0))
```
]

---

.small[

```r
addr %&gt;% mutate(address = paste(house_number, street_name) %&gt;% tolower())
```

```
## # Source:   lazy query [?? x 5]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##    issue_date precinct house_number street_name     address                
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;                  
##  1      15706       28 102          W 123 ST        102 w 123 st           
##  2      15706       23 2121         1 AVE           2121 1 ave             
##  3      15706       23 60           E 106 ST        60 e 106 st            
##  4      15706        5 54           ELIZABETH ST    54 elizabeth st        
##  5      15706       26 488-490      ST NICHOLAS AVE 488-490 st nicholas ave
##  6      15706       26 1420         AMSTERDAM AVE   1420 amsterdam ave     
##  7      15706       25 219          E 121 ST        219 e 121 st           
##  8      15706       12 630          LEXINGTON AVE   630 lexington ave      
##  9      15706       18 413          48 TH ST        413 48 th st           
## 10      15706       25 2123         MADISON AVE     2123 madison ave       
## # … with more rows
```

```r
addr %&gt;% mutate(address = paste(house_number, street_name) %&gt;% tolower()) %&gt;% show_query()
```

```
## &lt;SQL&gt;
## SELECT `issue_date`, `precinct`, `house_number`, `street_name`, LOWER(`house_number` || ' ' || `street_name`) AS `address`
## FROM (SELECT `issue_date`, `violation_precinct` AS `precinct`, `house_number`, `street_name`
## FROM `nyc`)
## WHERE ((`precinct` &gt;= 1.0) AND (`precinct` &lt;= 34.0))
```
]


---

.small[

```r
addr %&gt;% 
  mutate(address = paste(house_number, street_name) %&gt;% tolower()) %&gt;%
  mutate(address = stringr::str_replace(address, " th ", " "))
```

```
## Error in stri_replace_first_regex(string, pattern, fix_replacement(replacement), : object 'address' not found
```

--


```r
addr %&gt;% 
  mutate(address = paste(house_number, street_name) %&gt;% tolower()) %&gt;%
  mutate(address = gsub(" th ", " ", address))
```

```
## Error in result_create(conn@ptr, statement): no such function: GSUB
```

--


```r
addr %&gt;% 
  mutate(address = paste(house_number, street_name) %&gt;% tolower()) %&gt;%
  mutate(address = gsub(" th ", " ", address)) %&gt;%
  show_query()
```

```
## &lt;SQL&gt;
## SELECT `issue_date`, `precinct`, `house_number`, `street_name`, GSUB(' th ', ' ', `address`) AS `address`
## FROM (SELECT `issue_date`, `precinct`, `house_number`, `street_name`, LOWER(`house_number` || ' ' || `street_name`) AS `address`
## FROM (SELECT *
## FROM (SELECT `issue_date`, `violation_precinct` AS `precinct`, `house_number`, `street_name`
## FROM `nyc`)
## WHERE ((`precinct` &gt;= 1.0) AND (`precinct` &lt;= 34.0))))
```
]

---

.small[

```r
addr_local %&gt;% 
  mutate(address = paste(house_number, street_name) %&gt;% tolower()) %&gt;%
  mutate(address = stringr::str_replace(address, " th ", " "))
```

```
## # A tibble: 3,563,250 x 5
##    issue_date precinct house_number street_name     address                
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;                  
##  1      15706       28 102          W 123 ST        102 w 123 st           
##  2      15706       23 2121         1 AVE           2121 1 ave             
##  3      15706       23 60           E 106 ST        60 e 106 st            
##  4      15706        5 54           ELIZABETH ST    54 elizabeth st        
##  5      15706       26 488-490      ST NICHOLAS AVE 488-490 st nicholas ave
##  6      15706       26 1420         AMSTERDAM AVE   1420 amsterdam ave     
##  7      15706       25 219          E 121 ST        219 e 121 st           
##  8      15706       12 630          LEXINGTON AVE   630 lexington ave      
##  9      15706       18 413          48 TH ST        413 48 st              
## 10      15706       25 2123         MADISON AVE     2123 madison ave       
## # … with 3,563,240 more rows
```

```r
addr_local %&gt;% 
  mutate(address = paste(house_number, street_name) %&gt;% tolower()) %&gt;%
  mutate(address = gsub(" th ", " ", address))
```

```
## # A tibble: 3,563,250 x 5
##    issue_date precinct house_number street_name     address                
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;chr&gt;                  
##  1      15706       28 102          W 123 ST        102 w 123 st           
##  2      15706       23 2121         1 AVE           2121 1 ave             
##  3      15706       23 60           E 106 ST        60 e 106 st            
##  4      15706        5 54           ELIZABETH ST    54 elizabeth st        
##  5      15706       26 488-490      ST NICHOLAS AVE 488-490 st nicholas ave
##  6      15706       26 1420         AMSTERDAM AVE   1420 amsterdam ave     
##  7      15706       25 219          E 121 ST        219 e 121 st           
##  8      15706       12 630          LEXINGTON AVE   630 lexington ave      
##  9      15706       18 413          48 TH ST        413 48 st              
## 10      15706       25 2123         MADISON AVE     2123 madison ave       
## # … with 3,563,240 more rows
```
]

---

## (Unfair) Timings 

.small[

```r
system.time(
  nyc %&gt;%
    select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
    filter(precinct &gt;=1, precinct &lt;= 34) %&gt;%
    group_by(issue_date, precinct) %&gt;%
    summarize(n=n())
)
```

```
##    user  system elapsed 
##   0.303   0.129   0.433
```
]

.small[

```r
system.time(
  nyc_sql %&gt;%
    select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
    filter(precinct &gt;=1, precinct &lt;= 34) %&gt;%
    group_by(issue_date, precinct) %&gt;%
    summarize(n=n())
)
```

```
##    user  system elapsed 
##   0.005   0.000   0.004
```
]

--

`nyc_sql` was ~100x times faster than `nyc`, but the former is disk based while the latter is in memory, why this discrepancy?

---

.small[

```r
nyc %&gt;%
  select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
  filter(precinct &gt;=1, precinct &lt;= 34) %&gt;%
  group_by(issue_date, precinct) %&gt;%
  summarize(n=n())
```

```
## # A tibble: 10,410 x 3
## # Groups:   issue_date [712]
##    issue_date precinct     n
##    &lt;date&gt;        &lt;dbl&gt; &lt;int&gt;
##  1 2013-01-01        5     1
##  2 2013-01-01       12     1
##  3 2013-01-01       13     1
##  4 2013-01-01       14     1
##  5 2013-01-01       18     1
##  6 2013-01-01       23     2
##  7 2013-01-01       25     3
##  8 2013-01-01       26     3
##  9 2013-01-01       28     1
## 10 2013-01-02        6     2
## # … with 10,400 more rows
```

```r
nyc_sql %&gt;%
  select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
  filter(precinct &gt;=1, precinct &lt;= 34) %&gt;%
  group_by(issue_date, precinct) %&gt;%
  summarize(n=n())
```

```
## # Source:   lazy query [?? x 3]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
## # Groups:   issue_date
##    issue_date precinct     n
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1      15706        5     1
##  2      15706       12     1
##  3      15706       13     1
##  4      15706       14     1
##  5      15706       18     1
##  6      15706       23     2
##  7      15706       25     3
##  8      15706       26     3
##  9      15706       28     1
## 10      15707        6     2
## # … with more rows
```
]

---

## Laziness

dplyr / dbplyr uses lazy evaluation as much as possible, particularly when working with non-local backends.

* When building a query, we don't want the entire table, often we want just enough to check if our query is working.

* Since we would prefer to run one complex query over many simple queries, laziness allows for verbs to be strung together.

* Therefore, by default `dplyr`

* won't connect and query the database until absolutely necessary (e.g. show output),

* and unless explicitly told to, will only query a handful of rows to give a sense of what the result will look like.

---

## Full query 
.small[

To force a full query *and* a return of the complete result it is necessart to use the `collect` function.


```r
system.time({
  res = nyc_sql %&gt;%
    select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
    filter(precinct &gt;=1, precinct &lt;= 34) %&gt;%
    group_by(issue_date, precinct) %&gt;%
    summarize(n=n()) %&gt;%
    collect()
})
```

```
##    user  system elapsed 
##   3.687   0.253   3.952
```

```r
res
```

```
## # A tibble: 10,410 x 3
## # Groups:   issue_date [712]
##    issue_date precinct     n
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1      15706        5     1
##  2      15706       12     1
##  3      15706       13     1
##  4      15706       14     1
##  5      15706       18     1
##  6      15706       23     2
##  7      15706       25     3
##  8      15706       26     3
##  9      15706       28     1
## 10      15707        6     2
## # … with 10,400 more rows
```


`compute` and `collapse` also force a full query but have slightly different behavior and return types. 

]

---

## `compute`


```r
res_comp = nyc_sql %&gt;%
  select(issue_date, precinct = violation_precinct, house_number, street_name) %&gt;%
  filter(precinct &gt;=1, precinct &lt;= 34) %&gt;%
  group_by(issue_date, precinct) %&gt;%
  summarize(n=n()) %&gt;%
  compute()

res_comp
```

```
## # Source:   table&lt;yndlwmikua&gt; [?? x 3]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
## # Groups:   issue_date
##    issue_date precinct     n
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
##  1      15706        5     1
##  2      15706       12     1
##  3      15706       13     1
##  4      15706       14     1
##  5      15706       18     1
##  6      15706       23     2
##  7      15706       25     3
##  8      15706       26     3
##  9      15706       28     1
## 10      15707        6     2
## # … with more rows
```

---

.small[

```r
addr %&gt;% show_query()
```

```
## &lt;SQL&gt;
## SELECT *
## FROM (SELECT `issue_date`, `violation_precinct` AS `precinct`, `house_number`, `street_name`
## FROM `nyc`)
## WHERE ((`precinct` &gt;= 1.0) AND (`precinct` &lt;= 34.0))
```

```r
addr %&gt;%
  compute(name = "addresses", temporary = FALSE, 
          indexes = list("precinct"), 
          overwrite = TRUE)
```

```
## # Source:   table&lt;addresses&gt; [?? x 4]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##    issue_date precinct house_number street_name    
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;          
##  1      15706       28 102          W 123 ST       
##  2      15706       23 2121         1 AVE          
##  3      15706       23 60           E 106 ST       
##  4      15706        5 54           ELIZABETH ST   
##  5      15706       26 488-490      ST NICHOLAS AVE
##  6      15706       26 1420         AMSTERDAM AVE  
##  7      15706       25 219          E 121 ST       
##  8      15706       12 630          LEXINGTON AVE  
##  9      15706       18 413          48 TH ST       
## 10      15706       25 2123         MADISON AVE    
## # … with more rows
```
]

---

.small[

```r
db
```

```
## src:  sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
## tbls: addresses, nyc, sqlite_stat1, sqlite_stat1, sqlite_stat4, sqlite_stat4,
##   yndlwmikua
```

```r
tbl(db, "addresses")
```

```
## # Source:   table&lt;addresses&gt; [?? x 4]
## # Database: sqlite 3.22.0 [/data/nyc_parking/nyc_parking_2014_cleaned.sqlite]
##    issue_date precinct house_number street_name    
##         &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;          
##  1      15706       28 102          W 123 ST       
##  2      15706       23 2121         1 AVE          
##  3      15706       23 60           E 106 ST       
##  4      15706        5 54           ELIZABETH ST   
##  5      15706       26 488-490      ST NICHOLAS AVE
##  6      15706       26 1420         AMSTERDAM AVE  
##  7      15706       25 219          E 121 ST       
##  8      15706       12 630          LEXINGTON AVE  
##  9      15706       18 413          48 TH ST       
## 10      15706       25 2123         MADISON AVE    
## # … with more rows
```
]


---

## Acknowledgments

Above materials are derived in part from the following sources:

* [dbplyr - Introduction Vignette](https://cran.r-project.org/web/packages/dbplyr/vignettes/dbplyr.html)
* [dbplyr - SQL Translation](https://cran.r-project.org/web/packages/dbplyr/vignettes/sql-translation.html)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
